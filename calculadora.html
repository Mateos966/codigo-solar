<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora | C√≥digo Solar</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-success">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">C√≥digo Solar</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html#que-es">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="historicos.html">Datos Hist√≥ricos</a></li>
          <li class="nav-item"><a class="nav-link" href="calculadora.html">Calculadora</a></li>
          <li class="nav-item"><a class="nav-link active" href="#">Dashboard</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h2 class="text-center text-success mb-4">Calculadora de Energ√≠a Renovable</h2>
    <p class="text-center text-muted">
      Ingresa tu consumo mensual en kWh para conocer qu√© porcentaje puede ser cubierto por la capacidad global de
      energ√≠as renovables.
    </p>

    <form id="form-calculadora" class="row g-3 justify-content-center">
      <div class="col-md-6">
        <label for="consumo" class="form-label">Consumo el√©ctrico mensual (kWh)</label>
        <input type="number" min="1" class="form-control" id="consumo" placeholder="Ej: 300" required>
      </div>
      <div class="col-12 text-center">
        <button type="submit" class="btn btn-success mt-3">Calcular</button>
      </div>
    </form>

    <div class="text-center mt-4">
      <h4 id="resultado" class="text-primary fw-bold"></h4>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="bg-success text-white text-center py-3">
    <p class="mb-0">¬© 2025 C√≥digo Solar. Todos los derechos reservados.</p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    let capacidadGlobalMensual = 0;

    // Funci√≥n para convertir texto "18.325.000" ‚Üí 18325000 (n√∫mero)
    function parseTWh(str) {
      return parseFloat(str?.replaceAll('.', '').replace(',', '.') || "0");
    }

    // Leer CSV y calcular capacidad renovable global mensual
    Papa.parse("data/energia_renovable.csv", {
      download: true,
      header: true,
      delimiter: ";",
      complete: function (results) {
        const datos = results.data;
        const reciente = Math.max(...datos.map(r => parseInt(r["Year"])).filter(Boolean));
        const fila = datos.find(r => r["Entity"] === "World" && parseInt(r["Year"]) === reciente);

        if (fila) {
          const solar = parseTWh(fila["Solar Generation - TWh"]);
          const wind = parseTWh(fila["Wind Generation - TWh"]);
          const hydro = parseTWh(fila["Hydro Generation - TWh"]);
          const bio = parseTWh(fila["Geo Biomass Other - TWh"]);

          const totalTWh = solar + wind + hydro + bio;
          const totalKWh = totalTWh * 1_000_000_000;
          capacidadGlobalMensual = totalKWh / 12; // mensual
        }
      }
    });

    // Formulario de c√°lculo
    document.getElementById("form-calculadora").addEventListener("submit", function (e) {
      e.preventDefault();
      const consumo = parseFloat(document.getElementById("consumo").value);

      const resultado = document.getElementById("resultado");

      if (consumo > 0 && capacidadGlobalMensual > 0) {
        let porcentaje = (capacidadGlobalMensual / consumo) * 100;
        if (porcentaje >= 100) {
          resultado.textContent =
            `üåç La capacidad global renovable es m√°s que suficiente para cubrir tu consumo mensual (100%).`;
        } else {
          resultado.textContent =
            `‚ö° Aproximadamente el ${porcentaje.toFixed(2)}% de tu consumo mensual podr√≠a ser cubierto con energ√≠a renovable global.`;
        }
      } else {
        resultado.textContent = '‚ùå No se pudo calcular. Verifica el n√∫mero ingresado.';
      }
    });
  </script>
</body>

</html>